<div class="container card rounded-4 text-center shadow-sm mt-5">
  <h2 class="card-header mt-4 rounded-pill shadow-sm">Cadastro de Pessoa</h2>

  <div
    class="container mt-4 mb-3 d-flex justify-content-between align-items-center flex-nowrap gap-3 w-75 nowrap-text ">

    <!-- Campo de busca -->
    <div class="container d-flex justify-content-between me-sm-3  ">
      <div class="position-relative w-100">
        <i class="bi bi-search text-muted position-absolute top-50 start-0 translate-middle-y ms-3"></i>
        <input type="search" class="form-control rounded-pill ps-5" placeholder="Buscar..." aria-label="Buscar"
          [formControl]="searchControl">
      </div>
    </div>

    <!-- Botão adicionar que abre o offcanvas -->
    <button class="badge btn btn-primary shadow-sm rounded-pill py-2 px-4 " type="button" (click)="abrirOffcanvas()">
      <i class="bi bi-person-plus-fill fs-5"></i>
    </button>
  </div>

  <!-- Tabela responsiva com scroll interno (wrapper) -->
  <div class="container d-flex justify-content-center mb-4 nowrap-text table-wrapper  ">
    <div class="table-responsive shadow-sm rounded-4 border w-100 ">
      <!-- Para o scroll fica dentro da tabela e não fica por fora e comer a borda do border -->
      <div appDragScroll class="h-100 w-100 overflow-auto">
        <table class="table align-middle table-hover">
          <thead>
            <tr class="table-light">
              <th>#</th>
              <th>Foto</th>
              <th>Name</th>
              <th>Profissão</th>
              <th>Cidade</th>
              <th>Ações</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngIf="noResults">
              <td colspan="6" class="text-center">Nenhum resultado encontrado!</td>
            </tr>
            <!-- Itera os itens paginados (getItemsPaginated) na lista cadastro -->
            <tr *ngFor="let cadastro of getItemsPaginated(); trackBy: trackById">
              <!-- Colunas com titulos das colunas e os dados chamado pelo banco
               pela lista cadastro citada na linha acima -->
              <td>{{cadastro.id}}</td>
              <td class="align-middle text-center ">
                <ng-container *ngIf="cadastro.foto; else noPhoto">
                  <img [src]="cadastro.foto" alt="foto" class="img-thumbnail rounded-pill shadow-sm object-fit-cover ">
                </ng-container>
                <ng-template #noPhoto>
                  <div class="rounded-circle d-inline-block">
                    <i class="bi bi-person-circle text-muted fs-1"></i>
                  </div>
                </ng-template>
              </td>
              <td>
                <span class="fw-semibold">{{ cadastro.nome }}</span><br>
                <span class="text-black-50 fst-italic">{{ cadastro.email }}</span>
              </td>
              <td>{{ getProfissaoLabel(cadastro.profissao) }}</td>
              <td>
                <span class="fw-semibold">{{ cadastro.cidades }}</span><br>
                <span class="text-muted">{{ cadastro.estados }}</span>
              </td>
              <td>
                <!-- Ações -->
                <button type="button" class="badge btn btn-sm btn-info rounded-pill px-3 shadow-sm nowrap-text me-2"
                  (click)="edit(cadastro)">
                  <!-- Editar -->
                  <i class="bi bi-pencil-square"></i>
                </button>
                <button type="button" class="badge btn btn-sm btn-danger rounded-pill px-3 shadow-sm nowrap-text"
                  (click)="deleteById(cadastro)">
                  <!-- Deletar -->
                  <i class="bi bi-trash3"></i>
                </button>
              </td>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Dropdown -->
  <!-- Com contador, select de pageSize e paginação -->
  <div class="d-flex flex-wrap m-3 justify-content-between justify-content-md-between
            justify-content-center justify-content-sm-center align-items-center force-center-mobile">

    <div class="me-5 mb-4 text-nowrap">
      <!-- Total de itens da tabela na pagina -->
      Total:<span class="badge text-bg-primary rounded-pill shadow-sm px-3 py-2 mx-2 me-4">{{
        totalItens }}</span>

      <label for="pageSize" class="me-2 small-responsive">Itens por página</label>
      <!-- vinculado um select via ngModel ao pageSize para controle de quantidade de exibição na tabela -->
      <select id="pageSize" class="badge text-bg-light text-start form-select rounded-pill shadow-sm pe-4 py-2 w-25 "
        [(ngModel)]="pageSize" (change)="onPageSizeChange()">
        <option [value]="5">5</option>
        <option [value]="10">10</option>
        <option [value]="20">20</option>
        <option [value]="lista.length">Todos</option>
      </select>
    </div>

    <!-- Paginação (prev / pages / next) -->
    <nav aria-label="Page navigation  ">
      <ul class="pagination">
        <li class="page-item me-2 " [class.disabled]="currentPage === 1">
          <a class="btn btn-rounded btn-sm border rounded-pill shadow-sm p-0 px-3 "
            (click)="changePage(currentPage - 1)">
            <!-- Esquerda -->
            <i class="bi bi-chevron-left"></i>
          </a>
        </li>
        <!-- Valor -->
        <li class="page-item me-2  " *ngFor="let page of totalPagesArray" [class.active]="page === currentPage">
          <a class="page-link rounded-pill shadow-sm p-0 px-3" (click)="changePage(page)">{{page}}</a>
        </li>
        <li class="page-item " [class.disabled]="currentPage === totalPages">
          <a class="btn btn-rounded btn-sm border rounded-pill shadow-sm p-0 px-3"
            (click)="changePage(currentPage + 1)">
            <!-- Direita -->
            <i class="bi bi-chevron-right"></i></a>
        </li>
      </ul>
    </nav>
  </div>
</div>

<!-- Usando modo Offcanvas sem modal abrindo o form cadastro pela direita -->
<div class="offcanvas offcanvas-end rounded-start-5 custom-offcanvas" tabindex="-1" id="offcanvasCadastro"
  aria-labelledby="offcanvasCadastroLabel">

  <div class="offcanvas-header ">
    <h5 class="offcanvas-title card-header rounded-pill shadow-sm bg-light fs-4 px-4 mt-3 py-1"
      id="offcanvasCadastroLabel">
      Cadastre a Pessoa</h5>
    <button type="button" class="btn-close rounded-pill shadow-sm me-3 px-3 mt-3" data-bs-dismiss="offcanvas"
      aria-label="Close" (click)="fecharOffcanvas()"></button>
  </div>
  <!-- Aqui chama a dados pelo seletor onde tem que adcionar o @input e o @Output na ts que deseja chamar -->
  <div class="offcanvas-body">
    <app-cadastro [cadastro]="cadastroEdit" (retorno)="retornoCadastro($event)"></app-cadastro>
  </div>
</div>
